#!/bin/sh

print_line() {
    seq  -f "-" -s '' $COLUMNS
}
export -f print_line

print_git_status() {
  clear
  printf "Current branch: %s\n" $(git rev-parse --abbrev-ref HEAD)
  print_line
  git -c color.status=always --no-pager diff --shortstat
  git -c color.status=always status --short | sed "s/^/  /"
  print_line
  git log \
      --color \
      --graph \
      --pretty=format:'%Cred%h%Creset %G? - %s %Cgreen(%ar) %C(bold blue)<%an>%Creset' \
      --abbrev-commit \
      --date=relative \
      "$1"
}
export -f print_git_status

# Get the files from git
cd "$(git rev-parse --show-toplevel)" || exit

# Print the data every two seconds
watch --color --no-title print_git_status "$1"
